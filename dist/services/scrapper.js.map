{"version":3,"sources":["../../src/services/scrapper.ts"],"sourcesContent":["import { ServerException } from '@/exceptions';\nimport { ScrapeInfosResult, ScrappingSource, cheerioInfos, cheerioResult, puppeteerProps } from '@/interfaces/scrapping';\nimport { ApiPuppeteer } from '@utils/puppeteer';\nimport { load } from 'cheerio';\nimport { Service } from 'typedi';\n@Service()\nexport class ScrapperServiceFile extends ApiPuppeteer {\n  private shuffleArray(v: cheerioInfos[][]): cheerioInfos[] {\n    const shuffleArr = [].concat(...v);\n\n    for (let i = shuffleArr.length - 1; i > 0; i--) {\n      const mixed = Math.floor(Math.random() * (i + 1));\n      [shuffleArr[i], shuffleArr[mixed]] = [shuffleArr[mixed], shuffleArr[i]];\n    }\n\n    return shuffleArr;\n  }\n\n  private getFn(name: string): [(value: string) => cheerioResult, string] {\n    const functionName = {\n      LinkedIn: [this.LinkedIn, 'https://www.google.com/search'],\n    };\n\n    return functionName[name];\n  }\n\n  public async scrape(data: ScrappingSource[]): Promise<ScrapeInfosResult> {\n    const values: puppeteerProps[] = data.map(v => ({ ...v, props: this.getFn(v.site), retryCount: 0 }));\n\n    this.check(values);\n    const [error, success] = await this.open(values);\n    if (error) {\n      throw new ServerException();\n    }\n    const number = success\n      .filter(o => o.number)\n      .reduce((acc, n) => {\n        return (acc += n.number);\n      }, 0);\n\n    const result: cheerioInfos[][] = success\n      .filter(o => o.data)\n      .map(obj => {\n        if (!obj.current) {\n          return obj.data;\n        }\n        return obj.data.filter(v => v.currentCompany);\n      });\n\n    if (result.length === 1) {\n      return { scrape: result[0], number };\n    }\n\n    return { scrape: this.shuffleArray(result), number };\n  }\n\n  private LinkedIn(html: string): cheerioResult {\n    //? ----- linkedIn logic -----\n    const $ = load(html);\n\n    const linkedIn: cheerioResult = [];\n\n    const img = $('div.N54PNb.BToiNc.cvP2Ce').find('img.XNo5Ab').attr('src');\n\n    $('div.N54PNb.BToiNc.cvP2Ce').each((_, element) => {\n      const link = $(element).find('a[jsname=\"UWckNb\"]').attr('href');\n      const title = $(element).find('h3.LC20lb.MBeuO.DKV0Md').text().split(' - ');\n      const chip = [];\n      const chipWrapper = $(element).find('div.lhLbod.gEBHYd');\n      if (chipWrapper) {\n        chipWrapper.find('span').each((_, element) => {\n          const chipText = $(element).text();\n          if (chipText !== ' Â· ') {\n            chip.push(chipText);\n          }\n        });\n      }\n      const desc = $(element).find('div.VwiC3b.yXK7lf.lyLwlc.yDYNvb.W8l4ac.lEBKkf').text();\n      const fullName = title?.length > 0 ? title[0].toString().trim() : undefined;\n      const currentJob = chip?.length > 2 ? chip[1].toString().trim() : title?.length > 1 ? title[1].toString().trim() : undefined;\n      const currentCompany = title?.length > 2 ? title[2].toString().trim() : chip?.length > 1 ? chip[chip.length - 1].toString().trim() : undefined;\n      linkedIn.push({ link, img, fullName, currentJob, currentCompany, desc: desc?.trim() });\n    });\n\n    return linkedIn;\n  }\n  //? ----- linkedIn logic -----\n}\n\nexport default ScrapperServiceFile;\n"],"names":["ScrapperServiceFile","ApiPuppeteer","shuffleArray","v","shuffleArr","concat","i","length","mixed","Math","floor","random","getFn","name","functionName","LinkedIn","scrape","data","values","map","props","site","retryCount","check","error","success","open","ServerException","number","filter","o","reduce","acc","n","result","obj","current","currentCompany","html","$","load","linkedIn","img","find","attr","each","_","element","link","title","text","split","chip","chipWrapper","chipText","push","desc","fullName","toString","trim","undefined","currentJob","Service"],"mappings":"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"}