{"version":3,"sources":["../../src/controllers/favoris.ts"],"sourcesContent":["import auth from '@/middlewares/auth';\nimport FavorisFolderFile from '@/services/favFolders';\nimport FavorisServiceFile from '@/services/favoris';\nimport { idValidator, imgValidator, limitValidator, linkValidator, pageValidator, stringValidator } from '@libs/validate';\nimport mw from '@middlewares/mw';\nimport validator from '@middlewares/validator';\nimport Container from 'typedi';\n\nconst FavorisController = ({ app }) => {\n  const FavorisServices = Container.get(FavorisServiceFile);\n  const FavorisFolderServices = Container.get(FavorisFolderFile);\n  app.post(\n    '/create-fav',\n    mw([\n      auth(),\n      validator({\n        body: {\n          link: linkValidator.required(),\n          img: imgValidator.required(),\n          fullName: stringValidator.nonNullable(),\n          currentJob: stringValidator.nullable(),\n          currentCompany: stringValidator.nullable(),\n          desc: stringValidator.nonNullable(),\n          favFolderId: idValidator.required(),\n        },\n      }),\n      async ({\n        locals: {\n          body: { link, img, fullName, currentJob, currentCompany, desc, favFolderId },\n        },\n        session: { sessionId },\n        res,\n        next,\n      }) => {\n        try {\n          const success = await FavorisServices.createFav({ link, img, fullName, currentJob, currentCompany, desc, favFolderId }, sessionId);\n          res.send({ res: success });\n        } catch (error) {\n          next(error);\n        }\n      },\n    ]),\n  );\n  app.delete(\n    '/remove-fav',\n    mw([\n      auth(),\n      validator({\n        query: {\n          link: linkValidator.required(),\n          favFolderId: idValidator.required(),\n        },\n      }),\n      async ({\n        locals: {\n          query: { link, favFolderId },\n        },\n        res,\n        next,\n      }) => {\n        try {\n          const success = await FavorisServices.removeFav({ link, favFolderId });\n          res.send({ res: success });\n        } catch (error) {\n          next(error);\n        }\n      },\n    ]),\n  );\n  app.get(\n    '/get-favoris',\n    mw([\n      auth(),\n      validator({\n        query: {\n          limit: limitValidator.default(10),\n          page: pageValidator.default(1),\n          favFolderName: stringValidator.required(),\n        },\n      }),\n      async ({\n        locals: {\n          query: { limit, page, favFolderName },\n        },\n        session: { sessionId },\n        res,\n        next,\n      }) => {\n        try {\n          const favFolderModel = await FavorisFolderServices.getFolderByName(favFolderName, sessionId);\n\n          const { favoris, total } = await FavorisServices.getFavInFolder(limit, page, favFolderModel.id);\n\n          res.send({ res: { list: favoris, meta: { total } } });\n        } catch (error) {\n          next(error);\n        }\n      },\n    ]),\n  );\n  app.get(\n    '/get-lastFavoris',\n    mw([\n      auth(),\n      async ({ session: { sessionId }, res, next }) => {\n        try {\n          const favoris = await FavorisServices.getLastFav(sessionId);\n\n          res.send({ res: favoris });\n        } catch (error) {\n          next(error);\n        }\n      },\n    ]),\n  );\n};\nexport default FavorisController;\n"],"names":["FavorisController","app","FavorisServices","Container","get","FavorisServiceFile","FavorisFolderServices","FavorisFolderFile","post","mw","auth","validator","body","link","linkValidator","required","img","imgValidator","fullName","stringValidator","nonNullable","currentJob","nullable","currentCompany","desc","favFolderId","idValidator","locals","session","sessionId","res","next","success","createFav","send","error","delete","query","removeFav","limit","limitValidator","default","page","pageValidator","favFolderName","favFolderModel","getFolderByName","favoris","total","getFavInFolder","id","list","meta","getLastFav"],"mappings":"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"}